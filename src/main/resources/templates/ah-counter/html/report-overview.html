<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="../css/normalize.css" th:href="@{/ah-counter/css/normalize.css}">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/layui@2.7.6/dist/layui.js"></script>
    <script type="text/javascript" src="../../common/js/echarts.min.js" th:src="@{/common/js/echarts.min.js}"></script>
    <script type="text/javascript" src="../js/request.js" th:src="@{/ah-counter/js/request.js}" th:inline="javascript"></script>
    <script type="text/javascript" src="../js/initEcharts.js" th:src="@{/ah-counter/js/initEcharts.js}" th:inline="javascript"></script>
    <title>哼哈官汇报概览</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: rgb(27, 20, 72);
        }

        .main {
            width: 100%;
            height: 100%;
            text-align: center;
            background-color: rgb(27, 20, 72);
        }

        .title-wrapper {
            margin-top: 1%;
            font-family: "Courier New";
            font-weight: bold;
            color: azure;
            letter-spacing: 2px;
        }

        .loading-wrapper {
            animation-name: rotateIn; /* referring directly to the animation's @keyframe declaration */
            animation-duration: 1s; /* don't forget to set a duration! */
            animation-iteration-count: infinite;
            animation-direction: reverse;
            position: absolute;
            left: 45%;
            top: 40%;
            transform: translate(-50%, -50%);
        }

        .graph-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }

        /*手机*/
        @media screen and (max-width: 600px) {
            .echarts-graph {
                width: 150px;
                height: 150px;
                margin-top: 10%;
                margin-left: 10%;
            }

            .loading-wrapper {
                animation-name: rotateIn; /* referring directly to the animation's @keyframe declaration */
                animation-duration: 1s; /* don't forget to set a duration! */
                animation-iteration-count: infinite;
                animation-direction: reverse;
                position: absolute;
                left: 30%;
                top: 30%;
                transform: translate(-50%, -50%);
            }
        }

        /*PC*/
        @media screen and (min-width: 960px) {
            .echarts-graph {
                width: 800px;
                height: 500px;
                margin-top: 1%;
                margin-left: 1%;
            }
        }

    </style>
</head>
<body>
<div class="main">
    <div class="loading-wrapper">
        <svg t="1661943048170" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5072" width="200" height="200">
            <path d="M876.864 782.592c3.264 0 6.272-3.2 6.272-6.656 0-3.456-3.008-6.592-6.272-6.592-3.264 0-6.272 3.2-6.272 6.592 0 3.456 3.008 6.656 6.272 6.656z m-140.544 153.344c2.304 2.432 5.568 3.84 8.768 3.84a12.16 12.16 0 0 0 8.832-3.84 13.76 13.76 0 0 0 0-18.56 12.224 12.224 0 0 0-8.832-3.84 12.16 12.16 0 0 0-8.768 3.84 13.696 13.696 0 0 0 0 18.56zM552.32 1018.24c3.456 3.648 8.32 5.76 13.184 5.76a18.368 18.368 0 0 0 13.184-5.76 20.608 20.608 0 0 0 0-27.968 18.368 18.368 0 0 0-13.184-5.824 18.368 18.368 0 0 0-13.184 5.76 20.608 20.608 0 0 0 0 28.032z m-198.336-5.76c4.608 4.8 11.072 7.68 17.6 7.68a24.448 24.448 0 0 0 17.536-7.68 27.456 27.456 0 0 0 0-37.248 24.448 24.448 0 0 0-17.536-7.68 24.448 24.448 0 0 0-17.6 7.68 27.52 27.52 0 0 0 0 37.184z m-175.68-91.84c5.76 6.08 13.824 9.6 21.952 9.6a30.592 30.592 0 0 0 22.016-9.6 34.368 34.368 0 0 0 0-46.592 30.592 30.592 0 0 0-22.016-9.6 30.592 30.592 0 0 0-21.952 9.6 34.368 34.368 0 0 0 0 46.592z m-121.152-159.36c6.912 7.36 16.64 11.648 26.368 11.648a36.736 36.736 0 0 0 26.432-11.584 41.28 41.28 0 0 0 0-55.936 36.736 36.736 0 0 0-26.432-11.584 36.8 36.8 0 0 0-26.368 11.52 41.28 41.28 0 0 0 0 56zM12.736 564.672a42.88 42.88 0 0 0 30.784 13.44 42.88 42.88 0 0 0 30.784-13.44 48.128 48.128 0 0 0 0-65.216 42.88 42.88 0 0 0-30.72-13.44 42.88 42.88 0 0 0-30.848 13.44 48.128 48.128 0 0 0 0 65.216z m39.808-195.392a48.96 48.96 0 0 0 35.2 15.36 48.96 48.96 0 0 0 35.2-15.36 54.976 54.976 0 0 0 0-74.56 48.96 48.96 0 0 0-35.2-15.424 48.96 48.96 0 0 0-35.2 15.424 54.976 54.976 0 0 0 0 74.56zM168.32 212.48c10.368 11.008 24.96 17.408 39.68 17.408 14.592 0 29.184-6.4 39.552-17.408a61.888 61.888 0 0 0 0-83.84 55.104 55.104 0 0 0-39.616-17.408c-14.656 0-29.248 6.4-39.616 17.408a61.888 61.888 0 0 0 0 83.84zM337.344 124.8c11.52 12.16 27.712 19.264 43.968 19.264 16.256 0 32.448-7.04 43.968-19.264a68.672 68.672 0 0 0 0-93.184 61.248 61.248 0 0 0-43.968-19.264 61.248 61.248 0 0 0-43.968 19.264 68.736 68.736 0 0 0 0 93.184z m189.632-1.088c12.672 13.44 30.528 21.248 48.448 21.248s35.712-7.808 48.384-21.248a75.584 75.584 0 0 0 0-102.464A67.392 67.392 0 0 0 575.36 0c-17.92 0-35.776 7.808-48.448 21.248a75.584 75.584 0 0 0 0 102.464z m173.824 86.592c13.824 14.592 33.28 23.104 52.736 23.104 19.584 0 39.04-8.512 52.8-23.104a82.432 82.432 0 0 0 0-111.744 73.472 73.472 0 0 0-52.8-23.168c-19.52 0-38.912 8.512-52.736 23.168a82.432 82.432 0 0 0 0 111.744z m124.032 158.528c14.976 15.872 36.032 25.088 57.216 25.088 21.12 0 42.24-9.216 57.152-25.088a89.344 89.344 0 0 0 0-121.088 79.616 79.616 0 0 0-57.152-25.088c-21.184 0-42.24 9.216-57.216 25.088a89.344 89.344 0 0 0 0 121.088z m50.432 204.032c16.128 17.088 38.784 27.008 61.632 27.008 22.784 0 45.44-9.92 61.568-27.008a96.256 96.256 0 0 0 0-130.432 85.76 85.76 0 0 0-61.568-27.072c-22.848 0-45.44 9.984-61.632 27.072a96.192 96.192 0 0 0 0 130.432z"
                  fill="#ffffff" p-id="5073"></path>
        </svg>
    </div>
    <div class="title-wrapper">
        <div style="font-size: xx-large"><span>美好人生头马演讲俱乐部哼哈官汇报概览</span></div>
        <div style="font-size: x-large;margin-top: 0.5%">哼哈官：<span style="color: greenyellow" class="ahCounterName"></span></div>
        <div>哼哈词总使用次数：<span style="margin-top: 0.5%;color: yellow;font-size: xx-large" class="totalUsed"></span>次</div>
    </div>
    <div class="graph-wrapper">
        <div id="usedWordAndCountChart" class="echarts-graph">

        </div>
        <div id="usedGuestAndCountChart" class="echarts-graph">

        </div>
        <div id="mostUsedWordTop3" class="echarts-graph">

        </div>
        <div id="mostUsedGuestTop3" class="echarts-graph">

        </div>
        <div id="leastUsedGuestTop3" class="echarts-graph">

        </div>
        <div class="echarts-graph">

        </div>
    </div>
</div>

<script th:inline="javascript">
    $(function () {
        // 去掉加载中标识
        window.setTimeout(() => $('.loading-wrapper').css('display', 'none'), 1000);
        window.setTimeout(() => initOverviewCharts(), 1000);

    });

    const initOverviewCharts = async () => {
        // 哼哈词报告概览
        let reportOverviewAxiosResp = await getAhCounterReportOverview([[${reportNo}]]);
        if (!reportOverviewAxiosResp.data.success) {
            return;
        }

        const reportOverview = reportOverviewAxiosResp.data.data;

        // 初始化哼哈官名称
        const {ahCounter} = reportOverview;
        const {totalUsed} = reportOverview;
        $('.ahCounterName').text(ahCounter);
        $('.totalUsed').text(totalUsed);

        initWordAndCountChart(reportOverview);
        initGuestAndCountChart(reportOverview);
        initMostUsedGuestTop3(reportOverview);
        initLeastUsedGuestTop3(reportOverview);
        initMostUsedWordTop3(reportOverview);
    };

    function initWordAndCountChart(reportOverview) {
        const myChart = echarts.init(document.getElementById('usedWordAndCountChart'), 'dark');
        window.onresize = () => myChart.resize();

        const {ahWordsNameMapping, usedWordAndCount} = reportOverview;
        let dataAxis = [];
        let data = [];
        Object.keys(usedWordAndCount).forEach(key => {
            dataAxis.push(ahWordsNameMapping[key]);
            data.push(usedWordAndCount[key]);
        });

        const title = {
            text: '各个哼哈词使用次数',
            subtext: '备注：该图表会展示出现的哼哈词和对应的总使用次数'
        };
        initClickableBarChart(myChart, title, dataAxis, data, 100);
    }

    function initGuestAndCountChart(reportOverview) {
        const myChart = echarts.init(document.getElementById('usedGuestAndCountChart'), 'dark');
        window.onresize = () => myChart.resize();

        const {usedGuestAndCount} = reportOverview;
        let dataAxis = [];
        let data = [];
        Object.keys(usedGuestAndCount).forEach(key => {
            dataAxis.push(key);
            data.push(usedGuestAndCount[key]);
        });

        const title = {
            text: '嘉宾哼哈词使用次数',
            subtext: '备注：该图表会展示所有上场嘉宾的哼哈词总使用次数'
        };
        initClickableBarChart(myChart, title, dataAxis, data, 100);

    }

    function initMostUsedGuestTop3(reportOverview) {
        const myChart = echarts.init(document.getElementById('mostUsedGuestTop3'), 'dark');
        window.onresize = () => myChart.resize();

        const {mostUsedGuestTop3} = reportOverview;
        let data = [];
        Object.keys(mostUsedGuestTop3).forEach(key => {
            data.push({name: key, value: mostUsedGuestTop3[key]});
        });

        const title = {
            text: '哼哈词使用次数最多嘉宾前3',
            subtext: '备注：该图表会展示哼哈词使用次数最多的嘉宾前3名，这些嘉宾要多多注意下哦',
            left: 'left'
        };

        initPieChart(myChart, title, data);
    }

    function initLeastUsedGuestTop3(reportOverview) {
        const myChart = echarts.init(document.getElementById('leastUsedGuestTop3'), 'dark');
        window.onresize = () => myChart.resize();

        const {leastUsedGuestTop3} = reportOverview;
        let data = [];
        Object.keys(leastUsedGuestTop3).forEach(key => {
            data.push({name: key, value: leastUsedGuestTop3[key]});
        });

        const title = {
            text: '哼哈词使用次数最少嘉宾前3',
            subtext: '备注：该图表会展示哼哈词使用次数最少的嘉宾前3名，多多像ta们学习哦',
            left: 'left'
        };

        initPieChart(myChart, title, data);
    }

    function initMostUsedWordTop3(reportOverview) {
        const myChart = echarts.init(document.getElementById('mostUsedWordTop3'), 'dark');
        window.onresize = () => myChart.resize();

        const {ahWordsNameMapping, mostUsedWordTop3} = reportOverview;
        let data = [];
        Object.keys(mostUsedWordTop3).forEach(key => {
            data.push({name: ahWordsNameMapping[key], value: mostUsedWordTop3[key]});
        });

        const title = {
            text: '哼哈词使用最频繁前3',
            subtext: '备注：该图表会展示使用次数最多的哼哈词前3，大家要多多注意哦',
            left: 'left'
        };

        initPieChart(myChart, title, data);
    }

</script>
</body>
</html>